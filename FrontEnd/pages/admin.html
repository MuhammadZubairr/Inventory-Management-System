<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard â€” Inventory Management System</title>
    <!-- Bootstrap 5 CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Professional Theme CSS -->
    <link rel="stylesheet" href="../assets/css/theme.css?v=2">
    <link rel="stylesheet" href="../assets/css/style-pro.css">
    <!-- Inline style for immediate fix -->
    <style>
      .badge.bg-danger {
        background-color: #ef4444 !important;
        color: #ffffff !important;
      }
    </style>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body class="bg-light">

    <!-- Top navigation bar with breadcrumb and user info -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom sticky-top">
      <div class="container-fluid">
        <!-- Brand/Logo -->
        <span class="navbar-brand mb-0 h5 fw-bold">
          <i class="bi bi-boxes text-primary me-2"></i>Inventory Management System
        </span>
        
        <!-- Search Bar (Center) -->
        <div class="mx-auto d-none d-lg-block" style="max-width: 400px; width: 100%;">
          <div class="input-group input-group-sm">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input type="search" class="form-control border-start-0 ps-0" placeholder="Search products, suppliers, transactions..." aria-label="Search">
          </div>
        </div>

        <!-- Right side: Notifications, User -->
        <div class="d-flex align-items-center gap-3">
          <!-- Notifications -->
          <div class="dropdown">
            <button class="btn btn-link text-dark position-relative p-2" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-bell fs-5"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger text-white" style="font-size: 0.65rem; background-color: #ef4444 !important; color: #ffffff !important; font-weight: 600;">
                3
              </span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow" style="min-width: 320px;">
              <li class="px-3 py-2 border-bottom">
                <h6 class="mb-0">Notifications</h6>
              </li>
              <li><a class="dropdown-item py-2" href="#">
                <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                <small><span class="low-stock-count-notif">0</span> items low on stock</small>
              </a></li>
              <li><a class="dropdown-item py-2" href="#">
                <i class="bi bi-box-seam text-primary me-2"></i>
                <small>New stock received: 150 units</small>
              </a></li>
              <li><a class="dropdown-item py-2" href="#">
                <i class="bi bi-person-plus text-success me-2"></i>
                <small>New user registered</small>
              </a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-center small text-primary" href="#">View all notifications</a></li>
            </ul>
          </div>

          <!-- User Profile -->
          <div class="dropdown">
            <button class="btn btn-link text-dark p-0 d-flex align-items-center text-decoration-none" type="button" data-bs-toggle="dropdown">
              <div class="me-2 text-end d-none d-md-block">
                <div class="fw-semibold small admin-name">Admin User</div>
                <div class="text-muted" style="font-size: 0.75rem;">Administrator</div>
              </div>
              <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                <i class="bi bi-person-fill"></i>
              </div>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow">
              <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger logout-btn" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

          

    <div class="container-fluid">
      <div class="row">
        <!-- Left sidebar navigation (loaded dynamically) -->
        <div id="sidebar-container"></div>

        <!-- Main content area -->
        <main class="col-lg-10 col-md-9 py-4 px-4">
          <!-- Breadcrumb & Page Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                  <li class="breadcrumb-item"><a href="#" class="text-decoration-none">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                </ol>
              </nav>
              <h1 class="h3 mb-0 fw-bold">Dashboard Overview</h1>
              <p class="text-muted small mb-0">Welcome back! Here's what's happening with your inventory today.</p>
            </div>
            <div>
              <button class="btn btn-outline-secondary btn-sm me-2">
                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
              </button>
              <button class="btn btn-primary btn-sm">
                <i class="bi bi-download me-1"></i>Export Report
              </button>
            </div>
          </div>

          <!-- KPI Cards Row -->
          <div class="row g-3 mb-4">
            <!-- Total Products -->
            <div class="col-xl-3 col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                      <p class="text-muted mb-1 small text-uppercase" style="letter-spacing: 0.05em;">Total Products</p>
                      <h3 class="mb-0 fw-bold" id="total-products">-</h3>
                    </div>
                    <div class="rounded-3 p-2 bg-primary bg-opacity-10">
                      <i class="bi bi-box-seam fs-4 text-primary"></i>
                    </div>
                  </div>
                  <div class="d-flex align-items-center text-primary small">
                    <i class="bi bi-box-seam me-1"></i>
                    <span class="fw-semibold">In inventory</span>
                    <span class="text-muted ms-1">system</span>
                  </div>
                  <div class="progress mt-2" style="height: 4px;">
                    <div class="progress-bar bg-primary" role="progressbar" style="width: 100%"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Total Stock Value -->
            <div class="col-xl-3 col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                      <p class="text-muted mb-1 small text-uppercase" style="letter-spacing: 0.05em;">Stock Value</p>
                      <h3 class="mb-0 fw-bold" id="stock-value">PKR0</h3>
                    </div>
                    <div class="rounded-3 p-2 bg-success bg-opacity-10">
                      <i class="bi bi-currency-dollar fs-4 text-success"></i>
                    </div>
                  </div>
                  <div class="d-flex align-items-center text-success small">
                    <i class="bi bi-calculator me-1"></i>
                    <span class="fw-semibold">Total value</span>
                    <span class="text-muted ms-1">calculated</span>
                  </div>
                  <div class="progress mt-2" style="height: 4px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Low Stock Items -->
            <div class="col-xl-3 col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                      <p class="text-muted mb-1 small text-uppercase" style="letter-spacing: 0.05em;">Low Stock Items</p>
                      <h3 class="mb-0 fw-bold text-warning" id="low-stock">-</h3>
                    </div>
                    <div class="rounded-3 p-2 bg-warning bg-opacity-10">
                      <i class="bi bi-exclamation-triangle fs-4 text-warning"></i>
                    </div>
                  </div>
                  <div class="d-flex align-items-center text-muted small">
                    <i class="bi bi-check-circle me-1"></i>
                    <span class="fw-semibold">All stocked</span>
                    <span class="text-muted ms-1">currently</span>
                  </div>
                  <div class="progress mt-2" style="height: 4px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Active Suppliers -->
            <div class="col-xl-3 col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                      <p class="text-muted mb-1 small text-uppercase" style="letter-spacing: 0.05em;">Active Suppliers</p>
                      <h3 class="mb-0 fw-bold" id="total-suppliers">-</h3>
                    </div>
                    <div class="rounded-3 p-2 bg-info bg-opacity-10">
                      <i class="bi bi-truck fs-4 text-info"></i>
                    </div>
                  </div>
                  <div class="d-flex align-items-center text-success small">
                    <i class="bi bi-check-circle me-1"></i>
                    <span class="fw-semibold">All verified</span>
                    <span class="text-muted ms-1">& active</span>
                  </div>
                  <div class="progress mt-2" style="height: 4px;">
                    <div class="progress-bar bg-info" role="progressbar" style="width: 100%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts Row -->
          <div class="row g-3 mb-4">
            <!-- Inventory Trends Chart -->
            <div class="col-xl-8">
              <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom py-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-semibold">Inventory Trends</h5>
                    <div class="btn-group btn-group-sm" role="group" id="trendPeriodButtons">
                      <button type="button" class="btn btn-outline-secondary" data-period="week">Week</button>
                      <button type="button" class="btn btn-outline-secondary active" data-period="month">Month</button>
                      <button type="button" class="btn btn-outline-secondary" data-period="year">Year</button>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <canvas id="inventoryTrendsChart" height="80"></canvas>
                </div>
              </div>
            </div>

            <!-- Category Distribution Chart -->
            <div class="col-xl-4">
              <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom py-3">
                  <h5 class="mb-0 fw-semibold">Stock by Category</h5>
                </div>
                <div class="card-body">
                  <canvas id="categoryChart" height="200"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity & Quick Stats Row -->
          <div class="row g-3 mb-4">
            <!-- Recent Transactions -->
            <div class="col-xl-7">
              <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom py-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-semibold">Recent Transactions</h5>
                    <a href="/pages/reports.html" class="text-decoration-none small">View All <i class="bi bi-arrow-right"></i></a>
                  </div>
                </div>
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-hover mb-0">
                      <thead class="table-light">
                        <tr>
                          <th class="border-0 small text-uppercase">Type</th>
                          <th class="border-0 small text-uppercase">Product</th>
                          <th class="border-0 small text-uppercase">Quantity</th>
                          <th class="border-0 small text-uppercase">Date</th>
                          <th class="border-0 small text-uppercase">Status</th>
                        </tr>
                      </thead>
                      <tbody id="recent-transactions">
                        <tr>
                          <td colspan="5" class="text-center py-4">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Low Stock Alerts -->
            <div class="col-xl-5">
              <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom py-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-semibold">Low Stock Alerts</h5>
                    <span class="badge bg-warning low-stock-count">0</span>
                  </div>
                </div>
                <div class="card-body p-0">
                  <div class="list-group list-group-flush" id="low-stock-list">
                    <div class="list-group-item d-flex justify-content-center align-items-center" style="min-height: 100px;">
                      <div class="spinner-border spinner-border-sm text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-white border-top">
                  <a href="/pages/products.html" class="text-decoration-none small">View All Products <i class="bi bi-arrow-right"></i></a>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <footer class="mt-4 py-3 text-center">
            <p class="text-muted small mb-0">
              &copy; 2026 Inventory Management System. All rights reserved.
            </p>
          </footer>
        </main>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Navbar functionality (admin name display) -->
    <script src="../assets/js/navbar.js"></script>
    <!-- Sidebar auto-scroll -->
    <script src="../assets/js/sidebar-scroll.js"></script>
    <!-- Admin authentication and protection -->
    <script src="../assets/js/admin-auth.js"></script>
    <!-- Dashboard functionality -->
    <script src="../assets/js/dashboard.js"></script>
    
    <!-- Dashboard Charts -->
    <script>
      // Global chart instances
      let inventoryTrendsChart = null;
      let categoryChart = null;
      
      // Function to update inventory trends chart with real data
      window.updateInventoryTrendsChart = function(labels, stockInData, stockOutData) {
        if (inventoryTrendsChart) {
          inventoryTrendsChart.data.labels = labels;
          inventoryTrendsChart.data.datasets[0].data = stockInData;
          inventoryTrendsChart.data.datasets[1].data = stockOutData;
          inventoryTrendsChart.update();
        }
      };
      
      // Function to update category chart with real data
      window.updateCategoryChart = function(categories) {
        if (categoryChart && categories.length > 0) {
          const labels = categories.map(c => c._id.charAt(0).toUpperCase() + c._id.slice(1));
          const data = categories.map(c => c.count);
          const colors = [
            '#0066cc', '#00b894', '#fdcb6e', '#6c5ce7', '#adb5bd',
            '#e17055', '#00cec9', '#fd79a8', '#fab1a0', '#74b9ff'
          ];
          
          categoryChart.data.labels = labels;
          categoryChart.data.datasets[0].data = data;
          categoryChart.data.datasets[0].backgroundColor = colors.slice(0, categories.length);
          categoryChart.update();
        }
      };
      
      // Wait for Chart.js and DOM to be ready
      document.addEventListener('DOMContentLoaded', function() {
        // Inventory Trends Chart (Line Chart)
        const trendsCtx = document.getElementById('inventoryTrendsChart');
        if (trendsCtx) {
          inventoryTrendsChart = new Chart(trendsCtx, {
            type: 'line',
            data: {
              labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
              datasets: [
                {
                  label: 'Stock In',
                  data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                  borderColor: '#0066cc',
                  backgroundColor: 'rgba(0, 102, 204, 0.1)',
                  tension: 0.4,
                  fill: true,
                  borderWidth: 2
                },
                {
                  label: 'Stock Out',
                  data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                  borderColor: '#00b894',
                  backgroundColor: 'rgba(0, 184, 148, 0.1)',
                  tension: 0.4,
                  fill: true,
                  borderWidth: 2
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: {
                  display: true,
                  position: 'top',
                  align: 'end',
                  labels: {
                    usePointStyle: true,
                    padding: 15,
                    font: { size: 12, family: 'Inter' }
                  }
                },
                tooltip: {
                  mode: 'index',
                  intersect: false,
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  padding: 12,
                  cornerRadius: 8,
                  titleFont: { size: 13, family: 'Inter', weight: 'bold' },
                  bodyFont: { size: 12, family: 'Inter' }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: { color: 'rgba(0, 0, 0, 0.05)' },
                  ticks: { font: { size: 11, family: 'Inter' } }
                },
                x: {
                  grid: { display: false },
                  ticks: { font: { size: 11, family: 'Inter' } }
                }
              },
              interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
              }
            }
          });
        }

        // Category Distribution Chart (Doughnut Chart)
        const categoryCtx = document.getElementById('categoryChart');
        if (categoryCtx) {
          categoryChart = new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
              labels: [],
              datasets: [{
                data: [],
                backgroundColor: [],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: {
                  display: true,
                  position: 'bottom',
                  labels: {
                    padding: 15,
                    font: { size: 11, family: 'Inter' },
                    usePointStyle: true
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  padding: 12,
                  cornerRadius: 8,
                  titleFont: { size: 13, family: 'Inter', weight: 'bold' },
                  bodyFont: { size: 12, family: 'Inter' },
                  callbacks: {
                    label: function(context) {
                      return context.label + ': ' + context.parsed + '%';
                    }
                  }
                }
              }
            }
          });
        }
      });
    </script>

    <!-- Load Sidebar Component -->
    <script>
      // Load sidebar component
      fetch('../components/sidebar.html')
        .then(response => response.text())
        .then(html => {
          const container = document.getElementById('sidebar-container');
          container.innerHTML = html;
          
          // Execute the scripts in the loaded HTML
          const scripts = container.querySelectorAll('script');
          scripts.forEach(script => {
            const newScript = document.createElement('script');
            if (script.src) {
              newScript.src = script.src;
            } else {
              newScript.textContent = script.textContent;
            }
            document.body.appendChild(newScript);
          });
          
          // Highlight active nav link
          const currentPage = window.location.pathname.split('/').pop();
          document.querySelectorAll('.nav-link').forEach(link => {
            if (link.getAttribute('href') === `/pages/${currentPage}`) {
              link.classList.add('active');
            }
          });
        })
        .catch(error => console.error('Error loading sidebar:', error));
    </script>
  </body>
</html>
